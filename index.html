<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>缘生故如幻</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="记录一些有意思的事。">
<meta property="og:type" content="website">
<meta property="og:title" content="缘生故如幻">
<meta property="og:url" content="https://jiyou.github.io/blog/index.html">
<meta property="og:site_name" content="缘生故如幻">
<meta property="og:description" content="记录一些有意思的事。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="缘生故如幻">
<meta name="twitter:description" content="记录一些有意思的事。">
  
    <link rel="alternative" href="/atom.xml" title="缘生故如幻" type="application/atom+xml">
  
  
  <link rel="stylesheet" href="/blog/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/blog//img/head.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">You Ji</a></h1>
		</hgroup>

		
		<p class="header-subtitle">心言直故，如是乃至始终地位，中间永无诸委曲相。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/blog/">主页</a></li>
				        
							<li><a href="/blog/archives">所有文章</a></li>
				        
							<li><a href="/blog/tags/MIT-6-828">mit.6.828</a></li>
				        
							<li><a href="/blog/tags/leetcode">leetcode</a></li>
				        
							<li><a href="/blog/tags/blog">blog</a></li>
				        
							<li><a href="/blog/tags/ceph">ceph</a></li>
				        
							<li><a href="/blog/tags/stl">stl</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/JiYou" title="github">github</a>
					        
								<a class="zhihu" target="_blank" href="https://zhuanlan.zhihu.com/codeit" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/blog/tags/ceph/" style="font-size: 10px;">ceph</a> <a href="/blog/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/blog/tags/mit-6-828/" style="font-size: 10px;">mit.6.828</a> <a href="/blog/tags/stl/" style="font-size: 20px;">stl</a> <a href="/blog/tags/算法/" style="font-size: 15px;">算法</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/JiYou">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">code</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">You Ji</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img lazy-src="/blog//img/head.png" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">You Ji</h1>
			</hgroup>
			
			<p class="header-subtitle">心言直故，如是乃至始终地位，中间永无诸委曲相。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/blog/">主页</a></li>
		        
					<li><a href="/blog/archives">所有文章</a></li>
		        
					<li><a href="/blog/tags/MIT-6-828">mit.6.828</a></li>
		        
					<li><a href="/blog/tags/leetcode">leetcode</a></li>
		        
					<li><a href="/blog/tags/blog">blog</a></li>
		        
					<li><a href="/blog/tags/ceph">ceph</a></li>
		        
					<li><a href="/blog/tags/stl">stl</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/JiYou" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://zhuanlan.zhihu.com/codeit" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-stl/11.type_traits" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2018/07/20/stl/11.type_traits/" class="article-date">
  	<time datetime="2018-07-19T21:30:32.000Z" itemprop="datePublished">2018-07-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/07/20/stl/11.type_traits/">1.10 type traits</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="comment">/// integral_constant</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> <span class="number">_</span>Tp, <span class="number">_</span>Tp <span class="number">__</span>v&gt;</div><div class="line"><span class="keyword">struct</span> integral_constant &#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="number">_</span>Tp                  value = <span class="number">__</span>v; <span class="comment">// 注意static</span></div><div class="line">    <span class="keyword">typedef</span> <span class="number">_</span>Tp                           value_type;</div><div class="line">    <span class="keyword">typedef</span> integral_constant&lt;<span class="number">_</span>Tp, <span class="number">__</span>v&gt;   type;</div><div class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="keyword">operator</span> <span class="title">value_type</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> value; &#125;</div><div class="line">    <span class="function"><span class="keyword">constexpr</span> value_type <span class="title">operator</span><span class="params">()</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> value; &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 类静态成员的再次声明，在c++11中，constexpr应该不是需要重新声明定义的。</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> <span class="number">_</span>Tp, <span class="number">_</span>Tp <span class="number">__</span>v&gt;</div><div class="line"><span class="keyword">constexpr</span> <span class="number">_</span>Tp integral_constant&lt;<span class="number">_</span>Tp, <span class="number">__</span>v&gt;::value;</div></pre></td></tr></table></figure>
<h1 id="不一样的operator"><a href="#不一样的operator" class="headerlink" title="不一样的operator"></a>不一样的operator</h1><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">class</span> A &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="function"><span class="keyword">operator</span> <span class="title">int</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"value_type()"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">100</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"operator()()"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">101</span>;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">  A a;</div><div class="line">  <span class="keyword">int</span> t = a; <span class="comment">// 这里调用operator int() const</span></div><div class="line">  a();       <span class="comment">// 这里是做为仿函数被调用</span></div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>所以这里需要区别<code>operator type() const</code>和<code>type operator() const</code>。<br>一个是用来进行类型转换，一个是用来模拟仿函数。</p>
<h1 id="integral-constant-的作用"><a href="#integral-constant-的作用" class="headerlink" title="integral_constant 的作用"></a>integral_constant 的作用</h1><h2 id="字面常量参数"><a href="#字面常量参数" class="headerlink" title="字面常量参数"></a>字面常量参数</h2><p>在模板编程中，如果一个模板参数不是<code>typename T</code>而是<code>int N</code>或者<code>bool cond</code>这种参数，那么这个参数必须是字面常量。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">bool</span> cond, <span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> A ...</div><div class="line"></div><div class="line"><span class="comment">// 使用时</span></div><div class="line">A&lt;<span class="literal">true</span>, <span class="keyword">int</span>&gt; aInt;</div><div class="line">A&lt;<span class="literal">false</span>, <span class="keyword">int</span>&gt; bInt;</div></pre></td></tr></table></figure>
<p>而不能用</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">bool</span> cond = <span class="literal">false</span>;</div><div class="line">A&lt;cond, <span class="keyword">int</span>&gt; aInt; <span class="comment">// 这里编译出错</span></div></pre></td></tr></table></figure>
<p>当然也可以使用<code>c++11</code>引入的字面常量表达式</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">constexpr</span> <span class="keyword">bool</span> cond = <span class="literal">true</span>;</div><div class="line">A&lt;cond, <span class="keyword">int</span>&gt; aInt; <span class="comment">// OK</span></div></pre></td></tr></table></figure>
<p><strong>总结</strong><br>使用模板的时候，编译器的输入就是文本里面的字符，是不能存在任何存储空间的变量。因此，模板参数只能使用类型或者是字面常量。</p>
<p>也就是说，模板元编程的输入有两种：</p>
<ul>
<li>类型，比如int, double, float, 以及自定义类型。</li>
<li>类型常量，比如自定义了某种类型，然后定义了这种类型的字面常量。或者内建类型的字段常量，比如<code>false/true</code>或者<code>constexpr bool cond = true</code>这里cond也是属生字面常量。</li>
</ul>
<h2 id="如何通用地定义字面常量"><a href="#如何通用地定义字面常量" class="headerlink" title="如何通用地定义字面常量"></a>如何通用地定义字面常量</h2><p>由前面的模板元输入的可以知道，类型有两种，一种是<code>类型</code>一种是<code>类型对应的常量</code>。那么是否有方法可以把两者统一起来?</p>
<p>首先看一下支持<code>类型</code>和<code>常量</code>的写法。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">bool</span> X&gt;</div><div class="line">SomeCode</div><div class="line"></div><div class="line"><span class="comment">// use</span></div><div class="line">SomeCode&lt;someType, <span class="literal">true</span>&gt; x;</div></pre></td></tr></table></figure>
<p>在第二个参数这里就必须显示地指定类型。那么如何后面要支持其他通用的类型的常量，比如<code>int</code>类型的常量，又需要把同样的代码抄一遍。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line">temlate&lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> X&gt;</div><div class="line">SomeCode</div><div class="line"><span class="comment">// use</span></div><div class="line">SomeCode&lt;someType, <span class="number">10</span>&gt; x;</div></pre></td></tr></table></figure>
<p>这样就显示得一点也不泛型了。那么最好的办法是利用一个抽象把<code>类型字面常量</code>表示起来。这就是<code>integral_constant</code>。</p>
<p>首先看一下如何定义<code>bool</code>类型的常量：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::integral_constant&lt;<span class="keyword">bool</span>, <span class="literal">true</span>&gt; true_type</div><div class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::integral_constant&lt;<span class="keyword">bool</span>, <span class="literal">false</span>&gt; false_type</div></pre></td></tr></table></figure>
<p>那么，后面在定义模板的时候，就可以只写一份了。为了区分，这里把<code>SomeCode</code>改成<code>SomeClass</code>。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> ConstValue&gt;</div><div class="line"><span class="keyword">class</span> SomeClass &#123;</div><div class="line">    <span class="comment">// 引用到给定的常量的类型</span></div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> ConstValue::type const_type;</div><div class="line">    <span class="comment">// 引用到给定的常量的值</span></div><div class="line">    <span class="keyword">constexpr</span> const_type value = ConstValue::value;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>但是使用方式上就会有点麻烦了。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 原来是SomeCode&lt;int, false&gt; aInst;</span></div><div class="line"><span class="comment">// 现在是</span></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::integral_constant&lt;<span class="keyword">bool</span>, <span class="literal">true</span>&gt; true_type</div><div class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::integral_constant&lt;<span class="keyword">bool</span>, <span class="literal">false</span>&gt; false_type</div><div class="line">SomeClass&lt;<span class="keyword">int</span>, false_type&gt; aInst;</div><div class="line"></div><div class="line"><span class="comment">// 原来是SomeCode&lt;int, 10&gt; bInst;</span></div><div class="line"><span class="comment">// 现在是如下</span></div><div class="line">SomeClass&lt;<span class="keyword">int</span>, <span class="built_in">std</span>::integral_constant&lt;<span class="keyword">int</span>,<span class="number">10</span>&gt;&gt; bInst;</div></pre></td></tr></table></figure>
<p><strong>总结</strong></p>
<ul>
<li>从抽象上来说，代码的实现方直接把<code>类型字面常量</code>抽象成一个模板，并且<code>type/value</code>可以引用到相应的类型和值。</li>
<li>服务方<code>SomeClass</code>里面在引用到类型和字面常量值的时候，就通过<code>::type/::value</code>来引用。</li>
<li>客户端原本使用<code>SomeCode&lt;int, 10&gt;</code>的地方要修改成<code>SomeClass&lt;int, std::integral_constant&lt;int,10&gt;&gt;</code>。</li>
</ul>
<h1 id="定义一些常量"><a href="#定义一些常量" class="headerlink" title="定义一些常量"></a>定义一些常量</h1><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="comment">// The type used as a compile-time boolean with true value.</span></div><div class="line"><span class="keyword">typedef</span> integral_constant&lt;<span class="keyword">bool</span>, <span class="literal">true</span>&gt; true_type;</div><div class="line"></div><div class="line"><span class="comment">// The type used as a compile-time boolean with false value.</span></div><div class="line"><span class="keyword">typedef</span> integral_constant&lt;<span class="keyword">bool</span>, <span class="literal">false</span>&gt; false_type;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">bool</span> <span class="number">__</span>v&gt;</div><div class="line">  <span class="keyword">using</span> <span class="number">__b</span>ool_constant = integral_constant&lt;<span class="keyword">bool</span>, <span class="number">__</span>v&gt;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">bool</span> <span class="number">__</span>v&gt;</div><div class="line">  <span class="keyword">using</span> bool_constant = integral_constant&lt;<span class="keyword">bool</span>, <span class="number">__</span>v&gt;;</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/stl/">stl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/blog/categories/stl/">stl</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-stl/11.type_traits" data-title="1.10 type traits" data-url="undefined"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'undefined'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>







  
    <article id="post-stl/8.模板元编程" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2018/07/19/stl/8.模板元编程/" class="article-date">
  	<time datetime="2018-07-18T21:30:32.000Z" itemprop="datePublished">2018-07-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/07/19/stl/8.模板元编程/">1.8 模板元编程</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="模板元编程"><a href="#模板元编程" class="headerlink" title="模板元编程"></a>模板元编程</h1><ul>
<li>编译期数值计算: 求阶乘</li>
<li>类型计算: <code>if/else</code>, <code>is_same_type</code></li>
<li>代码计算</li>
</ul>
<p><img src="/blog/img/compiler.meta.step.png" alt=""></p>
<p>注意元编程的位置。</p>
<h1 id="编程形式"><a href="#编程形式" class="headerlink" title="编程形式"></a>编程形式</h1><p>从编程范型（programming paradigm）上来说，<code>C++模板</code>是函数式编程（functional programming），它的主要特点是：<code>函数调用不产生任何副作用（没有可变的存储）</code>，用<code>递归</code>形式实现<code>循环</code>结构的功能。C++模板的特例化提供了<code>条件判断能力</code>，而模板递归嵌套提供了循环的能力，这两点使得其具有和普通语言一样通用的能力（图灵完备性）。</p>
<p>总结一下就是：</p>
<ul>
<li>不能访问存储变量</li>
<li>偏特化来支持递归</li>
<li>偏特化实现<code>if/else</code>结构</li>
</ul>
<p>从<code>编程形式</code>来看，模板的<code>&lt;&gt;</code>中的模板参数相当于<code>函数调用</code>的<code>输入参数</code>，模板中的<code>typedef</code>或<code>static const</code>或<code>enum</code>定义函数返回值（<code>类型</code>或<code>数值</code>，<code>数值</code>仅支持<code>整型</code>，如果需要可以通过编码计算浮点数），代码计算是通过类型计算进而选择类型的函数实现的（C++ 属于静态类型语言，编译器对类型的操控能力很强）。</p>
<p>这里需要解释一下：</p>
<ul>
<li>templnate&lt;.输入类型.&gt;是函数的输入</li>
<li>typedef ….或者static constexpr 整型是函数的返回值</li>
<li>代码计算是通过不同的类型跳转到不同的函数来运行。</li>
</ul>
<p>这里有个非常简单的例子来说明这三点。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> i=<span class="number">1</span>&gt;</div><div class="line"><span class="keyword">class</span> someComputing &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">volatile</span> T* retType; <span class="comment">// 类型计算</span></div><div class="line">    <span class="keyword">enum</span> &#123; retValume = i + someComputing&lt;T, i<span class="number">-1</span>&gt;::retValume &#125;; <span class="comment">// 数值计算，递归</span></div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"someComputing: i="</span> &lt;&lt; i &lt;&lt; <span class="string">'\n'</span>; &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="comment">// 模板特例，递归终止条件</span></div><div class="line"><span class="keyword">class</span> someComputing&lt;T, <span class="number">0</span>&gt; &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">enum</span> &#123; retValume = <span class="number">0</span> &#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> codeComputing &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; T::f(); &#125; <span class="comment">// 根据类型调用函数，代码计算</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    someComputing&lt;<span class="keyword">int</span>&gt;::retType a=<span class="number">0</span>;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="keyword">sizeof</span>(a) &lt;&lt; <span class="string">'\n'</span>; <span class="comment">// 64-bit 程序指针</span></div><div class="line">    <span class="comment">// VS2013 默认最大递归深度500，GCC4.8 默认最大递归深度900（-ftemplate-depth=n）</span></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; someComputing&lt;<span class="keyword">int</span>, <span class="number">500</span>&gt;::retValume &lt;&lt; <span class="string">'\n'</span>; <span class="comment">// 1+2+...+500</span></div><div class="line">    codeComputing&lt;someComputing&lt;<span class="keyword">int</span>, <span class="number">99</span>&gt;&gt;::f();</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>.get(); <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>模板元编程的组织形式</p>
<p><img src="/blog/img/meta.programming.png" alt=""></p>
<h2 id="数值计算"><a href="#数值计算" class="headerlink" title="数值计算"></a>数值计算</h2><p>前面已经介绍了连续求和的模板。这里写一个编译时计算一个数值是否是质数。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> N&gt;</div><div class="line"><span class="keyword">struct</span> is_prime &#123;</div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">int</span> p, <span class="keyword">int</span> i&gt;</div><div class="line">    <span class="keyword">struct</span> check_prime &#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">bool</span> value = (p%i) &amp;&amp; check_prime&lt;p, i<span class="number">-1</span>&gt;::value;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">int</span> p&gt;</div><div class="line">    <span class="keyword">struct</span> check_prime&lt;p, <span class="number">2</span>&gt; &#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">bool</span> value = p == <span class="number">2</span> || (p &gt; <span class="number">2</span> &amp;&amp; (p&amp;<span class="number">0x01</span>));</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">int</span> p&gt;</div><div class="line">    <span class="keyword">struct</span> check_prime&lt;p, <span class="number">1</span>&gt; &#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">bool</span> value = <span class="literal">true</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">bool</span> value = N == <span class="number">2</span> || check_prime&lt;N, N<span class="number">-1</span>&gt;::value;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; is_prime&lt;<span class="number">5</span>&gt;::value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; is_prime&lt;<span class="number">7</span>&gt;::value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; is_prime&lt;<span class="number">2</span>&gt;::value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果是再写一个类，用来连续打印<code>&lt;=N</code>的所有的质数。写法如下：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> N&gt;</div><div class="line"><span class="keyword">struct</span> print_prime &#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">bool</span> value = (N &lt; <span class="number">2</span>) ? <span class="literal">false</span> : is_prime&lt;N&gt;::value;</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (value) &#123;</div><div class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; N &lt;&lt; <span class="string">":"</span> &lt;&lt; <span class="string">"true"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">        &#125;</div><div class="line">        print_prime&lt;N<span class="number">-1</span>&gt;::print();</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;&gt;</div><div class="line"><span class="keyword">struct</span> print_prime&lt;<span class="number">2</span>&gt; &#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">bool</span> value = <span class="literal">true</span>;</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="number">2</span> &lt;&lt; <span class="string">":"</span> &lt;&lt; <span class="string">"true"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/stl/">stl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/blog/categories/stl/">stl</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-stl/8.模板元编程" data-title="1.8 模板元编程" data-url="undefined"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'undefined'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>







  
    <article id="post-stl/9.模板的控制结构" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2018/07/19/stl/9.模板的控制结构/" class="article-date">
  	<time datetime="2018-07-18T21:30:32.000Z" itemprop="datePublished">2018-07-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/07/19/stl/9.模板的控制结构/">1.9 模板的控制结构</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="IF语句"><a href="#IF语句" class="headerlink" title="IF语句"></a>IF语句</h1><p>这里可以拿最开始的那个例子。也就是通过<code>if/else</code>实现控制语句。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">bool</span> value, <span class="keyword">typename</span> If, <span class="keyword">typename</span> Then&gt;</div><div class="line"><span class="keyword">struct</span> IF &#123;</div><div class="line">    <span class="keyword">typedef</span> If type;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> If, <span class="keyword">typename</span> Then&gt;</div><div class="line"><span class="keyword">struct</span> IF&lt;<span class="literal">false</span>, If, Then&gt; &#123;</div><div class="line">    <span class="keyword">typedef</span> Then type;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> IfClass &#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"IfClass"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> ThenClass &#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ThenClass"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    IF&lt;<span class="literal">true</span>, IfClass, ThenClass&gt;::type x;</div><div class="line">    x.print();</div><div class="line">    IF&lt;<span class="literal">false</span>, IfClass, ThenClass&gt;::type y;</div><div class="line">    y.print();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>自定义数据类型</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> len = <span class="number">4</span>;</div><div class="line"><span class="keyword">typedef</span> IF&lt;<span class="keyword">sizeof</span>(<span class="keyword">long</span> <span class="keyword">long</span>)==len, <span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">void</span>&gt;::type <span class="keyword">long_long_or_void_t</span>;</div><div class="line"><span class="keyword">typedef</span> IF&lt;<span class="keyword">sizeof</span>(<span class="keyword">long</span>)==len, <span class="keyword">long</span>, <span class="keyword">long_long_or_void_t</span>&gt;::type <span class="keyword">long_or_llong_void_t</span>;</div><div class="line"><span class="keyword">typedef</span> IF&lt;<span class="keyword">sizeof</span>(<span class="keyword">int</span>)==len, <span class="keyword">int</span>, <span class="keyword">long_or_llong_void_t</span>&gt;::type <span class="keyword">int_long_llong_void_t</span>;</div><div class="line"><span class="keyword">typedef</span> IF&lt;<span class="keyword">sizeof</span>(<span class="keyword">short</span>)==len, <span class="keyword">short</span>, <span class="keyword">int_long_llong_void_t</span>&gt;::type <span class="keyword">short_int_long_llong_void_t</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">short_int_long_llong_void_t</span> <span class="keyword">int32_t</span>;</div></pre></td></tr></table></figure>
<p>这里实际上就是想定义一个完全<code>4bytes</code>的整数类型。</p>
<p>如果嵌套一点，就是</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> len = <span class="number">4</span>;</div><div class="line"><span class="keyword">typedef</span></div><div class="line">    IF_&lt;<span class="keyword">sizeof</span>(<span class="keyword">short</span>)==len, <span class="keyword">short</span>,</div><div class="line">    IF_&lt;<span class="keyword">sizeof</span>(<span class="keyword">int</span>)==len, <span class="keyword">int</span>,</div><div class="line">    IF_&lt;<span class="keyword">sizeof</span>(<span class="keyword">long</span>)==len, <span class="keyword">long</span>,</div><div class="line">    IF_&lt;<span class="keyword">sizeof</span>(<span class="keyword">long</span> <span class="keyword">long</span>)==len, <span class="keyword">long</span> <span class="keyword">long</span>,</div><div class="line">    <span class="keyword">void</span>&gt;::reType&gt;::reType&gt;::reType&gt;::reType</div><div class="line"><span class="keyword">int32_t</span>; <span class="comment">// 定义一个指定字节数的类型</span></div><div class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="keyword">sizeof</span>(<span class="keyword">int32_t</span>) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div></pre></td></tr></table></figure>
<h1 id="WHILE语句"><a href="#WHILE语句" class="headerlink" title="WHILE语句"></a>WHILE语句</h1><p>通过模板，也可以实现一个<code>WHILE</code>语句。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="comment">// cond需要有value/type</span></div><div class="line"><span class="comment">// statement需要有next</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">template</span>&lt;<span class="keyword">typename</span>&gt; <span class="keyword">class</span> cond, <span class="keyword">typename</span> statement&gt;</div><div class="line"><span class="keyword">struct</span> WHILE &#123;</div><div class="line">    <span class="keyword">struct</span> STOP &#123;</div><div class="line">        <span class="keyword">typedef</span> statement type;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span></div><div class="line">        IF&lt;cond&lt;statement&gt;::value,</div><div class="line">            WHILE&lt;cond, <span class="keyword">typename</span> statement::next&gt;,</div><div class="line">            STOP</div><div class="line">        &gt;::type::type type;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>比如下面这个程序就是用来求解<code>1^x + 2^x + 3^x + ... + n^x</code>。代码中用<code>e</code>表示<code>x</code>注意，不是自然对数的那个<code>e</code>。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">bool</span> cond, <span class="keyword">typename</span> If, <span class="keyword">typename</span> Then&gt;</div><div class="line"><span class="keyword">struct</span> IF &#123;</div><div class="line">    <span class="keyword">typedef</span> If type;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> If, <span class="keyword">typename</span> Then&gt;</div><div class="line"><span class="keyword">struct</span> IF&lt;<span class="literal">false</span>, If, Then&gt; &#123;</div><div class="line">    <span class="keyword">typedef</span> Then type;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// cond需要有value/type</span></div><div class="line"><span class="comment">// statement需要有next</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">template</span>&lt;<span class="keyword">typename</span>&gt; <span class="keyword">class</span> cond, <span class="keyword">typename</span> statement&gt;</div><div class="line"><span class="keyword">struct</span> WHILE &#123;</div><div class="line">    <span class="keyword">struct</span> STOP &#123;</div><div class="line">        <span class="keyword">typedef</span> statement type;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span></div><div class="line">        IF&lt;cond&lt;statement&gt;::value,</div><div class="line">            WHILE&lt;cond, <span class="keyword">typename</span> statement::next&gt;,</div><div class="line">            STOP</div><div class="line">        &gt;::type::type type;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 计算 1^e+2^e+...+n^e</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> n, <span class="keyword">int</span> e&gt;</div><div class="line"><span class="keyword">struct</span> sum_pow &#123;</div><div class="line">    <span class="comment">// pow是取x^e</span></div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">int</span> x&gt;</div><div class="line">    <span class="keyword">struct</span> <span class="built_in">pow</span> &#123;</div><div class="line">        <span class="comment">// p^q的求解</span></div><div class="line">        <span class="keyword">template</span>&lt;<span class="keyword">int</span> p, <span class="keyword">int</span> q&gt;</div><div class="line">        <span class="keyword">struct</span> pow_q &#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">int</span> value = p * pow_q&lt;p,q<span class="number">-1</span>&gt;::value;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">template</span>&lt;<span class="keyword">int</span> p&gt;</div><div class="line">        <span class="keyword">struct</span> pow_q&lt;p, <span class="number">0</span>&gt; &#123;</div><div class="line">            <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">int</span> value = <span class="number">1</span>;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">int</span> value = pow_q&lt;x,e&gt;::value;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> statement&gt;</div><div class="line">    <span class="keyword">struct</span> cond &#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">bool</span> value = statement::iter &lt;= n;</div><div class="line">        <span class="keyword">typedef</span> statement type;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">int</span> i, <span class="keyword">int</span> sum&gt;</div><div class="line">    <span class="keyword">struct</span> statement &#123;</div><div class="line">        <span class="keyword">typedef</span> statement&lt;i+<span class="number">1</span>, sum+<span class="built_in">pow</span>&lt;i&gt;::value&gt; next;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">int</span> iter = i;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">int</span> value = sum;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">int</span> value = WHILE&lt;cond, statement&lt;<span class="number">1</span>,<span class="number">0</span>&gt;&gt;::type::value;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    <span class="comment">// 1^2 + 2^2 + ... + 10^2</span></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; sum_pow&lt;<span class="number">10</span>,<span class="number">2</span>&gt;::value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="有趣的编译错误"><a href="#有趣的编译错误" class="headerlink" title="有趣的编译错误"></a>有趣的编译错误</h1><p>这个编译错误是在无意中写错程序发现的。那就是利用<code>WHILE</code>循环来求最大公约数。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">bool</span> cond, <span class="keyword">typename</span> If, <span class="keyword">typename</span> Then&gt;</div><div class="line"><span class="keyword">struct</span> IF &#123;</div><div class="line">    <span class="keyword">typedef</span> If type;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> If, <span class="keyword">typename</span> Then&gt;</div><div class="line"><span class="keyword">struct</span> IF&lt;<span class="literal">false</span>, If, Then&gt; &#123;</div><div class="line">    <span class="keyword">typedef</span> Then type;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// cond has type/value</span></div><div class="line"><span class="comment">// statement has next</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">template</span> &lt;<span class="keyword">typename</span>&gt; <span class="keyword">class</span> cond, <span class="keyword">typename</span> statement&gt;</div><div class="line"><span class="keyword">struct</span> WHILE &#123;</div><div class="line">    <span class="keyword">struct</span> STOP &#123;</div><div class="line">        <span class="keyword">typedef</span> statement type;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> IF&lt;</div><div class="line">        cond&lt;statement&gt;::value,</div><div class="line">        WHILE&lt;cond, <span class="keyword">typename</span> statement::next&gt;,</div><div class="line">        STOP</div><div class="line">    &gt;::type::type type; </div><div class="line">    <span class="comment">// 注意：这里有两层type,</span></div><div class="line">    <span class="comment">// 第一层是IF&lt;&gt;::type，比如递归结束时，定位到STOP</span></div><div class="line">    <span class="comment">// 第二层是通过剥开STOP，通过STOP拿到最后的类型=STOP::type</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// Test GCD while循环</span></div><div class="line"><span class="comment">/*</span></div><div class="line"> * a,b</div><div class="line"> * while (b) &#123;</div><div class="line"> *     temp = b;</div><div class="line"> *     b = a % b;</div><div class="line"> *     a = b;</div><div class="line"> * &#125;</div><div class="line"> */</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> a, <span class="keyword">int</span> b&gt;</div><div class="line"><span class="keyword">struct</span> GCD &#123;</div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> statement&gt;</div><div class="line">    <span class="keyword">struct</span> cond &#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">bool</span> value = statement::i != <span class="number">0</span>;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">int</span> x, <span class="keyword">int</span> y&gt;</div><div class="line">    <span class="keyword">struct</span> statement &#123;</div><div class="line">        <span class="keyword">typedef</span> statement&lt;y, x%y&gt; next;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">int</span> i = x%y;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">int</span> value = y;</div><div class="line">        <span class="comment">// 注意：i = y; value = x % y会导致编译通不过</span></div><div class="line">        <span class="comment">// 这里一定要注意，就是防止出现</span></div><div class="line">        <span class="comment">// x % 0 的情况</span></div><div class="line">        <span class="comment">// 由于当i = y, value = x % y的时候无法避免这种情况，</span></div><div class="line">        <span class="comment">// 报错信息就特别奇怪</span></div><div class="line">        <span class="comment">// non-type template argument is not a constant expression</span></div><div class="line">        <span class="comment">// division by zero -&gt; 这里才是关键</span></div><div class="line">        <span class="comment">// 如果给的值是statement&lt;10, 5&gt;</span></div><div class="line">        <span class="comment">//   -&gt; typedef statement&lt;5, 0&gt; next;</span></div><div class="line">        <span class="comment">//   -&gt; i = 5,</span></div><div class="line">        <span class="comment">//   -&gt; value = 0;</span></div><div class="line">        <span class="comment">// WHILE里面会发现i = 5，于是还可以展开statement&lt;5,0&gt;</span></div><div class="line">        <span class="comment">//   -&gt; typedef statement&lt;0,5%0&gt; next;  &lt;-- 这里也就报错了。</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">static</span>  <span class="keyword">const</span> <span class="keyword">int</span> value = WHILE&lt;cond, statement&lt;a,b&gt;&gt;::type::value;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; Sum&lt;<span class="number">100</span>&gt;::value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; PowSum&lt;<span class="number">10</span>,<span class="number">2</span>&gt;::value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; GCD&lt;<span class="number">10</span>, <span class="number">5</span>&gt;::value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一定要注意程序中的注释：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 注意：i = y; value = x % y会导致编译通不过</span></div><div class="line"><span class="comment">// 这里一定要注意，就是防止出现</span></div><div class="line"><span class="comment">// x % 0 的情况</span></div><div class="line"><span class="comment">// 由于当i = y, value = x % y的时候无法避免这种情况，</span></div><div class="line"><span class="comment">// 报错信息就特别奇怪</span></div><div class="line"><span class="comment">// non-type template argument is not a constant expression</span></div><div class="line"><span class="comment">// division by zero -&gt; 这里才是关键</span></div><div class="line"><span class="comment">// 如果给的值是statement&lt;10, 5&gt;</span></div><div class="line"><span class="comment">//   -&gt; typedef statement&lt;5, 0&gt; next;</span></div><div class="line"><span class="comment">//   -&gt; i = 5,</span></div><div class="line"><span class="comment">//   -&gt; value = 0;</span></div><div class="line"><span class="comment">// WHILE里面会发现i = 5，于是还可以展开statement&lt;5,0&gt;</span></div><div class="line"><span class="comment">//   -&gt; typedef statement&lt;0,5%0&gt; next;  &lt;-- 这里也就报错了。</span></div></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/stl/">stl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/blog/categories/stl/">stl</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-stl/9.模板的控制结构" data-title="1.9 模板的控制结构" data-url="undefined"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'undefined'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>







  
    <article id="post-stl/10.循环展开" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2018/07/19/stl/10.循环展开/" class="article-date">
  	<time datetime="2018-07-18T21:30:32.000Z" itemprop="datePublished">2018-07-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/07/19/stl/10.循环展开/">1.9 循环展开</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="冒泡排序的展开"><a href="#冒泡排序的展开" class="headerlink" title="冒泡排序的展开"></a>冒泡排序的展开</h1><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>* data, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>( n &lt;= <span class="number">1</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n<span class="number">-1</span>; ++j)</div><div class="line">        <span class="keyword">if</span>(data[j] &gt; data[j+<span class="number">1</span>])</div><div class="line">            <span class="built_in">std</span>::swap(data[j], data[j+<span class="number">1</span>]);</div><div class="line">    bubbleSort(data, n<span class="number">-1</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> j&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">check_swap</span><span class="params">(<span class="keyword">int</span> *data)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (data[j] &gt; data[j+<span class="number">1</span>])</div><div class="line">        <span class="built_in">std</span>::swap(data[j], data[j+<span class="number">1</span>]);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 不能让j==n</span></div><div class="line"><span class="comment">// 因为下一把递归到check_swap的时候</span></div><div class="line"><span class="comment">// j+1就超出n了。</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> n, <span class="keyword">int</span> j&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">bloop</span><span class="params">(<span class="keyword">int</span> *data)</span> </span>&#123;</div><div class="line">    check_swap&lt;j&gt;(data);</div><div class="line">    <span class="comment">// 本来递归的写法就应该是</span></div><div class="line">    <span class="comment">// bloop&lt;n, j+1&gt;(data);</span></div><div class="line">    <span class="comment">// 但是这种写法以是无穷展开</span></div><div class="line">    <span class="comment">// 所以需要判断j+1 &gt; n</span></div><div class="line">    <span class="comment">// 如果j+1 &gt; n，然后把第二个模板参数</span></div><div class="line">    <span class="comment">// 设置为-1</span></div><div class="line">    bloop&lt; (j+<span class="number">1</span> &gt;= n? <span class="number">-1</span> : n), (j+<span class="number">1</span> &gt;= n? <span class="number">-1</span> : j+<span class="number">1</span>)&gt;(data);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;&gt;</div><div class="line"><span class="keyword">void</span> bloop&lt;<span class="number">-1</span>,<span class="number">-1</span>&gt;(<span class="keyword">int</span> *data) &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> N&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">bsort</span><span class="params">(<span class="keyword">int</span> *data)</span> </span>&#123;</div><div class="line">    <span class="comment">// for (i = 0, i &lt; N-1; check_swap(i,i+1))</span></div><div class="line">    <span class="comment">// 也就是0, N-1</span></div><div class="line">    bloop&lt;N<span class="number">-1</span>, <span class="number">0</span>&gt;(data);</div><div class="line">    bsort&lt;N<span class="number">-1</span>&gt;(data);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;&gt;</div><div class="line"><span class="keyword">void</span> bsort&lt;<span class="number">1</span>&gt;(<span class="keyword">int</span> *data) &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;&gt;</div><div class="line"><span class="keyword">void</span> bsort&lt;<span class="number">0</span>&gt;(<span class="keyword">int</span> *data) &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> data[] = &#123;<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>&#125;;</div><div class="line">    bsort&lt;<span class="number">4</span>&gt;(data);</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> x : data) &#123;</div><div class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; x &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="代码膨胀"><a href="#代码膨胀" class="headerlink" title="代码膨胀"></a>代码膨胀</h1><p>为了实现封装细节，那么可以把上面的<code>bloop/check_swap</code>函数都放到一个类里面，写法如下：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> n&gt;</div><div class="line"><span class="keyword">class</span> IntBubbleSortC &#123;</div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">int</span> j&gt;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> check_swap ....</div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">int</span> n, <span class="keyword">int</span> j&gt;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> bloop ...</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> bsort ...</div><div class="line">&#125;;</div><div class="line"><span class="keyword">template</span>&lt;&gt;</div><div class="line"><span class="keyword">class</span> IntBubbleSortC&lt;<span class="number">0</span>&gt; &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>* data)</span> </span>&#123; &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> data[<span class="number">4</span>] = &#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>&#125;;</div><div class="line">    IntBubbleSortC&lt;<span class="number">4</span>&gt;::sort(data); <span class="comment">// 如此调用</span></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>.get(); <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是这里一定要注意的是类内部的函数定义一定要使用<code>inline</code>函数。否则会导致代码膨胀。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/stl/">stl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/blog/categories/stl/">stl</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-stl/10.循环展开" data-title="1.9 循环展开" data-url="undefined"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'undefined'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>







  
    <article id="post-stl/7.Cpp11的扩展" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2018/07/18/stl/7.Cpp11的扩展/" class="article-date">
  	<time datetime="2018-07-17T21:30:32.000Z" itemprop="datePublished">2018-07-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/07/18/stl/7.Cpp11的扩展/">1.7 c++11的扩展</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><code>&gt;&gt;</code> 根据上下文自动识别正确语义；</li>
<li>函数模板参数默认值；</li>
<li>变长模板参数（扩展 sizeof…() 获取参数个数）；</li>
<li>模板别名（扩展 using 关键字）；</li>
<li>外部模板实例（拓展 extern 关键字），弃用 export template。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/stl/">stl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/blog/categories/stl/">stl</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-stl/7.Cpp11的扩展" data-title="1.7 c++11的扩展" data-url="undefined"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'undefined'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>







  
    <article id="post-stl/6.模板的编译" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2018/07/18/stl/6.模板的编译/" class="article-date">
  	<time datetime="2018-07-17T21:29:32.000Z" itemprop="datePublished">2018-07-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/07/18/stl/6.模板的编译/">1.6 模板的编译</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>模板的编译一般采用包含编译，(其他比较偏门的会介绍<code>export</code>啥的)，<code>export</code>已经被废止了，所以不再去研究。</p>
<p>正确的做法是:</p>
<ul>
<li>模板的实现都放到<code>.h</code>也就是头文件里面</li>
<li>使用的时候直接包含头文件</li>
</ul>
<p>在链接阶段，如果是因为模板生成的代码，比如类定义或者函数义有多份，那么会自动去重。</p>
<h1 id="嵌套类型依赖"><a href="#嵌套类型依赖" class="headerlink" title="嵌套类型依赖"></a>嵌套类型依赖</h1><p>假设想使用<code>T</code>类里面的<code>iterator</code>，如果代码写做如下：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">print2nd</span><span class="params">(<span class="keyword">const</span> T&amp; container)</span></span></div><div class="line">&#123;</div><div class="line">    T::const_iterator * x;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于编译器并不清楚<code>const_iterator</code>是一个类型，还是静态变量，大多数情况下会认为是一个<code>静态变量</code>。但是，这里实际上是一个类型，所以这里会编译报错。</p>
<p>那么正确的写法应该是</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">print2nd</span><span class="params">(<span class="keyword">const</span> T&amp; container)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">typename</span> T::const_iterator *x;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>也就是说，在嵌套类型依赖的时候，需要明确的指出<code>typename</code>这个类型。</p>
<h2 id="例外"><a href="#例外" class="headerlink" title="例外"></a>例外</h2><p>只有2个地方是不需要在嵌套依赖的时候来指明<code>typename</code>的，那么就是声明继承的时候。</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">template&lt;typename T&gt;</div><div class="line">class Derived: public Base&lt;T&gt;::Nested // 1. 这里不需要</div><div class="line">&#123;</div><div class="line">　public:</div><div class="line">　　explicit Derived(int x)</div><div class="line">　　: Base&lt;T&gt;::Nested(x) //  2. 这里也不需要</div><div class="line">　　&#123;</div><div class="line">　　　typename Base&lt;T&gt;::Nested temp; //nested dependent type, need typename</div><div class="line">　　&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>比如，这里<code>Nested</code>就是<code>Base&lt;T&gt;</code>里面的一个类型。实际上，这里也很明显，那就是继承肯定是继承于类型，而不是一个静态变量。</p>
<h1 id="类中的模板函数"><a href="#类中的模板函数" class="headerlink" title="类中的模板函数"></a>类中的模板函数</h1><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> aTMP&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">const</span> T reType;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"global f()"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> Base &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">int</span> N = <span class="number">99</span>&gt;  <span class="comment">// 这里需要声明模板函数</span></div><div class="line">    <span class="keyword">void</span> f() &#123;</div><div class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"member f(): "</span> &lt;&lt; N &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; </div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h1 id="this指针"><a href="#this指针" class="headerlink" title="this指针"></a>this指针</h1><p>this 用于指定查找基类中的成员</p>
<ul>
<li>（当基类是依赖模板参数的类模板实例时，由于实例化总是推迟，这时不依赖模板参数的名字不在基类中查找，文献[1]第 166 页）</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> aTMP&#123;</div><div class="line"><span class="keyword">public</span>: <span class="keyword">typedef</span> <span class="keyword">const</span> T reType;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"global f()\n"</span>; &#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> Base &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">int</span> N = <span class="number">99</span>&gt;</div><div class="line">    <span class="keyword">void</span> f() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"member f(): "</span> &lt;&lt; N &lt;&lt; <span class="string">'\n'</span>; &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> Derived : <span class="keyword">public</span> Base&lt;T&gt; &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">typename</span> T::reType m; <span class="comment">// typename 不能省略</span></div><div class="line">    Derived(<span class="keyword">typename</span> T::reType a) : m(a) &#123; &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">df1</span><span class="params">()</span> </span>&#123; f(); &#125;                       <span class="comment">// 调用全局 f()，而非想象中的基类 f()</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">df2</span><span class="params">()</span> </span>&#123; <span class="keyword">this</span>-&gt;<span class="function"><span class="keyword">template</span> <span class="title">f</span><span class="params">()</span></span>; &#125;        <span class="comment">// 基类 f&lt;99&gt;()</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">df3</span><span class="params">()</span> </span>&#123; Base&lt;T&gt;::<span class="keyword">template</span> f&lt;<span class="number">22</span>&gt;(); &#125; <span class="comment">// 强制基类 f&lt;22&gt;()</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">df4</span><span class="params">()</span> </span>&#123; ::f(); &#125;                     <span class="comment">// 强制全局 f()</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    Derived&lt;aTMP&lt;<span class="keyword">int</span>&gt;&gt; a(<span class="number">10</span>);</div><div class="line">    a.df1(); a.df2(); a.df3(); a.df4();</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>.get(); <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/stl/">stl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/blog/categories/stl/">stl</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-stl/6.模板的编译" data-title="1.6 模板的编译" data-url="undefined"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'undefined'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>







  
    <article id="post-stl/1.type_traits" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2018/07/18/stl/1.type_traits/" class="article-date">
  	<time datetime="2018-07-17T21:28:32.000Z" itemprop="datePublished">2018-07-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/07/18/stl/1.type_traits/">1.1 type_traits</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="If-else的结构"><a href="#If-else的结构" class="headerlink" title="If else的结构"></a>If else的结构</h1><p>有时候想在编译的时候，实现这样的效果，就是根据传入的值来决定需要产生的类型。<br>比如：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">function</span><span class="params">(type X, type Y)</span> </span>&#123;</div><div class="line">    <span class="comment">// if a == true 定义类型X</span></div><div class="line">    <span class="keyword">constexpr</span> <span class="keyword">bool</span> a = <span class="literal">true</span>/<span class="literal">false</span>;</div><div class="line">    <span class="keyword">if</span> (a) &#123;</div><div class="line">        X var;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        Y var;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 如果想在这里引用var，应该怎么办?</span></div><div class="line">    <span class="comment">// ?? 实际上是不能在这里用的。</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一种解决办法是，写一个父类，然后把<code>X/Y</code>声明成<code>Base</code>的子类。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">class</span> Base &#123;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">class</span> X : <span class="keyword">public</span> Base &#123;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Y : <span class="keyword">public</span> Base &#123;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">function</span><span class="params">(<span class="keyword">bool</span> a, type X, type Y)</span> </span>&#123;</div><div class="line">    Base * b = <span class="literal">nullptr</span>;</div><div class="line">    <span class="keyword">if</span> (a) &#123;</div><div class="line">        b = <span class="keyword">new</span> X();</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        b = <span class="keyword">new</span> Y();</div><div class="line">    &#125;</div><div class="line">    b.接口调用();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是这么写会很烦人：</p>
<ol>
<li>引入了不必要的父类</li>
<li>XY可能已经有自己的父类</li>
<li>X/Y如果还需要与Z在其他地方生成这样的代码关系，那还得生成一个父类</li>
</ol>
<p>这个时候，采用面向对象的方法代码会写得比较丑，那么一种办法是引入模板偏特化。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> <span class="keyword">bool</span>, <span class="keyword">typename</span> If, <span class="keyword">typename</span> Then&gt;</div><div class="line"><span class="keyword">struct</span> cond &#123;</div><div class="line">    <span class="keyword">typedef</span> If type;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> If, <span class="keyword">typename</span> Then&gt;</div><div class="line"><span class="keyword">struct</span> cond&lt;<span class="literal">false</span>, If, Then&gt;&#123;</div><div class="line">    <span class="keyword">typedef</span> Then type;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>使用方式</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">class</span> X&#123;&#125;;</div><div class="line"><span class="keyword">class</span> Y&#123;&#125;;</div><div class="line">cond&lt;<span class="literal">true</span>, X, Y&gt;::type 此时为 X</div><div class="line">cond&lt;<span class="literal">false</span>, X, Y&gt;::type 就是Y</div></pre></td></tr></table></figure>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">bool</span> Bool, <span class="keyword">typename</span> If, <span class="keyword">typename</span> Then&gt;</div><div class="line"><span class="keyword">struct</span> cond &#123;</div><div class="line">    <span class="keyword">typedef</span> If type;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> If, <span class="keyword">typename</span> Then&gt;</div><div class="line"><span class="keyword">struct</span> cond&lt;<span class="literal">false</span>, If, Then&gt;&#123;</div><div class="line">    <span class="keyword">typedef</span> Then type;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">class</span> If &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"If"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Then &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Then"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    <span class="comment">// 需要注意的是，true/false这里需要是编译期间就可以决定的常量。</span></div><div class="line">    <span class="comment">// 不能写成bool a = true, 然后cond&lt;a, If, Then&gt;这样。</span></div><div class="line">    cond&lt;<span class="literal">true</span>, If, Then&gt;::type::print();</div><div class="line">    cond&lt;<span class="literal">false</span>, If, Then&gt;::type::print();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里相当于在进行类型运算:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="keyword">constexpr</span> <span class="literal">true</span>) &#123;</div><div class="line">    <span class="keyword">return</span> type=X;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span> type=Y;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里就需要引出后面要介绍的模板元编程。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/stl/">stl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/blog/categories/stl/">stl</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-stl/1.type_traits" data-title="1.1 type_traits" data-url="undefined"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'undefined'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>







  
    <article id="post-stl/5.模板实例化" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2018/07/18/stl/5.模板实例化/" class="article-date">
  	<time datetime="2018-07-17T21:28:32.000Z" itemprop="datePublished">2018-07-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/07/18/stl/5.模板实例化/">1.5 模板实例化</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>实例化的定义：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">指在编译或链接时生成函数模板或类模板的具体实例源代码，即用使用模板时的实参类型替换模板类型参数（还有非类型参数和模板型参数）；</div></pre></td></tr></table></figure>
<p>有点类似于C语言中的宏来生成代码。</p>
<h1 id="实例化的方式"><a href="#实例化的方式" class="headerlink" title="实例化的方式"></a>实例化的方式</h1><ul>
<li>隐式实例化（implicit instantiation）：当使用实例化的模板时自动地在当前代码单元之前插入模板的实例化代码，模板的成员函数一直到引用时才被实例化；</li>
<li>显式实例化（explicit instantiation）：直接声明模板实例化，模板所有成员立即都被实例化；</li>
</ul>
<p>实例化也是一种<code>偏特化</code>，被称为实例化的特例（instantiated (or generated) specialization）。</p>
<h1 id="隐式实例化"><a href="#隐式实例化" class="headerlink" title="隐式实例化"></a>隐式实例化</h1><p>由于隐式实例化的存在，也就是编译的报错会推迟，导致出错信息特别长。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> X &#123; &#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;typenmae T&gt;</div><div class="line"><span class="keyword">class</span> Y &#123; &#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> Z &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    X&lt;Y&gt; x_;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>可以发现这个依赖链条比较长<code>Z-&gt;X-&gt;Y</code>，如果一旦出错，那么这个编译出错信息会特别长。所以针对模板而言，尽量在做测试时将其实例化掉。尽早发现编译错误。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/stl/">stl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/blog/categories/stl/">stl</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-stl/5.模板实例化" data-title="1.5 模板实例化" data-url="undefined"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'undefined'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>







  
    <article id="post-stl/2.模板简介" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2018/07/18/stl/2.模板简介/" class="article-date">
  	<time datetime="2018-07-17T21:28:32.000Z" itemprop="datePublished">2018-07-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/07/18/stl/2.模板简介/">1.2 模板元编程</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="模板示例"><a href="#模板示例" class="headerlink" title="模板示例"></a>模板示例</h1><p>这里自己实现一个判断两个对象是否相等的模板函数。同时也定义一个模板类。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">equ</span><span class="params">(<span class="keyword">const</span> T &amp;a, <span class="keyword">const</span> T &amp;b)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> !(a &lt; b) &amp;&amp; !(b &lt; a);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> number &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    number(<span class="keyword">const</span> T &amp;v): v_(v) &#123; &#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> number &amp;n) <span class="keyword">const</span> ;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    T v_;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">bool</span> number&lt;T&gt;::<span class="keyword">operator</span> &lt;(<span class="keyword">const</span> number &amp;n) <span class="keyword">const</span> &#123;</div><div class="line">    <span class="keyword">return</span> v_ &lt; n.v_;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    number&lt;<span class="keyword">int</span>&gt; a(<span class="number">1</span>), b(<span class="number">1</span>);</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; equ(a, b) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; equ&lt;<span class="keyword">double</span>&gt;(<span class="number">1.0</span>, <span class="number">2.0</span>) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="模板的参数"><a href="#模板的参数" class="headerlink" title="模板的参数"></a>模板的参数</h1><ul>
<li>类型参数（type template parameter），用 typename 或 class 标记；(最好是用<code>typename</code>)</li>
<li>非类型参数（non-type template parameter）可以是：整数及枚举类型、对象或函数的指针、对象或函数的引用、对象的成员指针，非类型参数是模板实例的常量；</li>
<li>模板型参数（template template parameter），如<code>template&lt;typename T, template&lt;typename&gt; class A&gt; someclass {};</code>；</li>
<li>模板参数可以有默认值（函数模板参数默认是从 C++11 开始支持）；</li>
<li>函数模板的和函数参数类型有关的模板参数可以自动推导，<strong>类模板参数不存在推导机制</strong>；</li>
<li>C++11 引入变长模板参数。</li>
</ul>
<p>总结一下：</p>
<ul>
<li>参数必须是字面量。无论常数，类型，自定义类型，模板类型都是编译时的常量。运行时的变量是不能用的。</li>
<li>类和函数模板参数都可以有默认值</li>
<li>函数可以自动推导，类模板不可以。</li>
</ul>
<p><strong>运行时变量不可以</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> N&gt;</div><div class="line"><span class="keyword">struct</span> Vec&#123;</div><div class="line">    T v_[N];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;&gt;</div><div class="line"><span class="keyword">struct</span> Vec&lt;<span class="keyword">float</span>, <span class="number">4</span>&gt; &#123;</div><div class="line">    <span class="keyword">float</span> v_[<span class="number">4</span>];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> N&gt;</div><div class="line"><span class="keyword">struct</span> Vec&lt;<span class="keyword">bool</span>, N&gt;&#123;</div><div class="line">    <span class="keyword">char</span> v_[(N+<span class="keyword">sizeof</span>(<span class="keyword">char</span>)<span class="number">-1</span>)/<span class="keyword">sizeof</span>(<span class="keyword">char</span>)];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N = <span class="number">10</span>;        <span class="comment">// 这里是一个变量</span></div><div class="line">    Vec&lt;<span class="keyword">bool</span>, N&gt; bits; <span class="comment">// Compile ERROR! 利用变量来模板化类</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那么函数是否可以呢？</p>
<h1 id="特化"><a href="#特化" class="headerlink" title="特化"></a>特化</h1><p>特化的时候，可以：</p>
<ul>
<li>将<code>Base</code>模板里面的类具体化。</li>
<li>只具体化某个模板参数，其他的保留。</li>
</ul>
<h2 id="所有的参数具体化"><a href="#所有的参数具体化" class="headerlink" title="所有的参数具体化"></a>所有的参数具体化</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> N&gt;</div><div class="line"><span class="keyword">struct</span> Vec&#123;</div><div class="line">    T v_[N];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;&gt;</div><div class="line"><span class="keyword">struct</span> Vec&lt;<span class="keyword">float</span>, <span class="number">4</span>&gt; &#123;</div><div class="line">    <span class="keyword">float</span> v_[<span class="number">4</span>];</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>比如在<code>base</code>类里面声明了两个参数，这两个参数都可以具体化。<code>T = float, N = 4</code>。</p>
<h2 id="具体化某部分参数"><a href="#具体化某部分参数" class="headerlink" title="具体化某部分参数"></a>具体化某部分参数</h2><p><code>base</code>类的参数是<code>typename T, int N</code>，那么可不可以只具体化<code>typename T = bool</code>呢？答案是可以的。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> N&gt;</div><div class="line"><span class="keyword">struct</span> Vec&#123;</div><div class="line">    T v_[N];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> N&gt;</div><div class="line"><span class="keyword">struct</span> Vec&lt;<span class="keyword">bool</span>, N&gt; &#123;</div><div class="line">    <span class="keyword">char</span> v_[(N+<span class="keyword">sizeof</span>(<span class="keyword">char</span>)<span class="number">-1</span>)/<span class="keyword">sizeof</span>(<span class="keyword">char</span>)];</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>术语:</p>
<ul>
<li><p>最简单的情况是对每个模板参数指定一个具体值，这成为完全特例化（<code>full specialization</code>），</p>
</li>
<li><p>另外，可以限制模板参数在一个范围取值或满足一定关系等，这称为部分特例化（<code>partial specialization</code>）</p>
</li>
</ul>
<p>用数学上集合的概念，通例模板参数所有可取的值组合构成全集U，完全特例化对U中某个元素进行专门定义，部分特例化对U的某个真子集进行专门定义。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/stl/">stl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/blog/categories/stl/">stl</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-stl/2.模板简介" data-title="1.2 模板元编程" data-url="undefined"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'undefined'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>







  
    <article id="post-stl/4.模板特化" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2018/07/18/stl/4.模板特化/" class="article-date">
  	<time datetime="2018-07-17T21:28:32.000Z" itemprop="datePublished">2018-07-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2018/07/18/stl/4.模板特化/">1.4 模板偏特化</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="偏特化"><a href="#偏特化" class="headerlink" title="偏特化"></a>偏特化</h1><p>前面介绍过，模板的偏特化可以有两种形式</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> N&gt;</div><div class="line"><span class="keyword">struct</span> Vec&#123;</div><div class="line">    T v_[N];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;&gt;</div><div class="line"><span class="keyword">struct</span> Vec&lt;<span class="keyword">float</span>, <span class="number">4</span>&gt; &#123;</div><div class="line">    <span class="keyword">float</span> v_[<span class="number">4</span>];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">int</span> N&gt;</div><div class="line"><span class="keyword">struct</span> Vec&lt;<span class="keyword">bool</span>, N&gt;&#123;</div><div class="line">    <span class="keyword">char</span> v_[(N+<span class="keyword">sizeof</span>(<span class="keyword">char</span>)<span class="number">-1</span>)/<span class="keyword">sizeof</span>(<span class="keyword">char</span>)];</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li>把所有的参数具体化，比如<code>T = float, N = 4</code></li>
<li>把部分参数具体化，比如<code>T = bool</code></li>
</ul>
<p>需要注意的是，已经被具体化的参数就不要再出现在<code>template&lt;&gt;</code>这里面了。如果所有的参数都被具体化的，那么<code>template&lt;&gt;</code>这里面就什么都没有了。</p>
<p>比较复杂的是两种情况，也就是模板特化与<code>模板模板参数</code>混在一起的时候。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;typeinfo&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> U&gt; <span class="keyword">class</span> A &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    T t_;</div><div class="line">    U u_;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> U&gt; <span class="keyword">class</span> A&lt;<span class="keyword">int</span>, U&gt; &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">   <span class="keyword">short</span> x;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// V这里的参数只能从T/U/X里面选择。</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U, <span class="keyword">typename</span> X, <span class="keyword">template</span>&lt;<span class="keyword">typename</span>, <span class="keyword">typename</span>&gt; <span class="keyword">class</span> V&gt; <span class="keyword">class</span> B &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    V&lt;T, U&gt; v_;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"B"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">B&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">float</span>, A&gt; c;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    c.print();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接着再分析另外一个例子。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> i&gt; <span class="keyword">class</span> Arg; <span class="comment">// 用于模板型模板参数</span></div><div class="line"><span class="comment">// 通例</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2, <span class="keyword">int</span> i, <span class="keyword">template</span>&lt;<span class="keyword">typename</span>, <span class="keyword">int</span>&gt; <span class="keyword">class</span> CP&gt;</div><div class="line"><span class="keyword">class</span> Example &#123; &#125;;</div><div class="line"></div><div class="line"><span class="comment">// 完全特例化</span></div><div class="line"><span class="keyword">template</span>&lt;&gt;</div><div class="line"><span class="keyword">class</span> Example&lt;<span class="keyword">int</span>, <span class="keyword">float</span>, <span class="number">2</span>, Arg&gt;;</div><div class="line"></div><div class="line"><span class="comment">// 第一个参数有const修饰</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2, <span class="keyword">int</span> i, <span class="keyword">template</span>&lt;<span class="keyword">typename</span>, <span class="keyword">int</span>&gt; <span class="keyword">class</span> CP&gt;</div><div class="line"><span class="keyword">class</span> Example&lt;<span class="keyword">const</span> T1, T2, i, CP&gt; &#123; &#125;;</div></pre></td></tr></table></figure>
<p>需要注意的是后面的那个<code>class CP</code>在选择类型的时候，只能从<code>T1/T2/i</code>里面选择了。</p>
<h1 id="类型组合的特化"><a href="#类型组合的特化" class="headerlink" title="类型组合的特化"></a>类型组合的特化</h1><p>再看一个有趣的例子。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 第一二个参数为Arg的实例且满足一定关系，第四个参数为Arg</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> i&gt;</div><div class="line"><span class="keyword">class</span> Example&lt;Arg&lt;T, i&gt;, Arg&lt;T, i+<span class="number">10</span>&gt;, i, Arg&gt; &#123; &#125;;</div></pre></td></tr></table></figure>
<p>也就是说，在特化的时候，可以写成这样。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;参数范围A&gt;</div><div class="line"><span class="keyword">class</span> Example&lt;由A范围组合出按照顺序满足条件的这个具体类型即可&gt; &#123; &#125;;</div></pre></td></tr></table></figure>
<p>那么在类里面使用<code>Arg</code>的时候，可以选择的参数范围就是已知的类型。比如：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> i&gt; <span class="keyword">class</span> Arg&#123; &#125;; <span class="comment">// 用于模板型模板参数</span></div><div class="line"><span class="comment">// 通例</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2, <span class="keyword">int</span> i, <span class="keyword">template</span>&lt;<span class="keyword">typename</span>, <span class="keyword">int</span>&gt; <span class="keyword">class</span> CP&gt;</div><div class="line"><span class="keyword">class</span> Example &#123; &#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> i&gt;</div><div class="line"><span class="keyword">class</span> Example&lt;<span class="keyword">const</span> T, Arg&lt;T,i+<span class="number">10</span>&gt;, i, Arg&gt; &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Arg&lt;T, i&gt; s_;</div><div class="line">    Arg&lt;<span class="keyword">const</span> T, i&gt; a_;</div><div class="line">    Arg&lt;Arg&lt;T,i&gt;,i&gt; b_;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>所以，可以看出<code>Arg</code>这个模板类可以使用<code>T,i, const T, Arg&lt;T,i+10&gt;, i,</code>都可以。</p>
<p>关于模板特化</p>
<ul>
<li>Base模板需要提前声明</li>
<li>如果模板A是模板B的子集，优先匹配A。</li>
<li>如果两个模板有交集，且不成子集关系，编译报错。</li>
</ul>
<h1 id="模板偏特化元编程"><a href="#模板偏特化元编程" class="headerlink" title="模板偏特化元编程"></a>模板偏特化元编程</h1><p>可以利用偏特化来实现<code>if/else</code>对类型的操作。比如判断两个类型是否相等。代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;</div><div class="line"><span class="keyword">struct</span> is_same &#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">bool</span> value = <span class="literal">false</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">struct</span> is_same&lt;T,T&gt; &#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">bool</span> value = <span class="literal">true</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 自定义类型，只是用来测试is_same模板</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> N&gt;</div><div class="line"><span class="keyword">struct</span> Example &#123; &#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> uint;</div><div class="line">    <span class="keyword">typedef</span> uint uint2;</div><div class="line"></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; is_same&lt;<span class="keyword">unsigned</span>, uint2&gt;::value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; is_same&lt;Example&lt;<span class="keyword">unsigned</span>, <span class="number">2</span>&gt;, Example&lt;uint2, <span class="number">2</span>&gt;&gt;::value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; is_same&lt;Example&lt;<span class="keyword">int</span>, <span class="number">2</span>&gt;, Example&lt;<span class="keyword">int</span>, <span class="number">3</span>&gt;&gt;::value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="计算阶乘"><a href="#计算阶乘" class="headerlink" title="计算阶乘"></a>计算阶乘</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">#include &lt;iostream&gt;</div><div class="line">#include &lt;stdint.h&gt;</div><div class="line"></div><div class="line">template&lt;int N&gt;</div><div class="line">struct order &#123;</div><div class="line">    static constexpr int64_t value = N * order&lt;N-1&gt;::value;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">// 由于只有一个参数需要偏特化，所以</div><div class="line">// 这里用template&lt;&gt;</div><div class="line">template&lt;&gt;</div><div class="line">struct order&lt;0&gt; &#123;</div><div class="line">    static constexpr int64_t value = 1;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">int main(void) &#123;</div><div class="line">    std::cout &lt;&lt; order&lt;10&gt;::value &lt;&lt; std::endl;</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/stl/">stl</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/blog/categories/stl/">stl</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-stl/4.模板特化" data-title="1.4 模板偏特化" data-url="undefined"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'undefined'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="page-number" href="/blog/page/3/">3</a><a class="extend next" rel="next" href="/blog/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 You Ji
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: /blog/
	}
</script>
<script src="/blog/js/require-2.1.6_jquery-1.9.1.min.js"></script>
<script src="/blog/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

</script>



  </div>
</body>
</html>